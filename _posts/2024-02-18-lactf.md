---
layout: post
title: LA CTF 2024
description: With graph theory, CSS can steal your password.
date: 2024-02-18
tags:
  - programming
  - ctf
---

As [ACM Cyber at UCSD][acmucsd], we played as one team for [LA CTF][lactf], hosted by [ACM Cyber at UCLA][acmucla]. Altogether, we placed 18th globally, of over 1000 teams, and solved 38 of the 53 challenges available.

[acmucsd]: https://acmucsd.com/communities#Cyber
[acmucla]: https://www.acmcyber.com/
[lactf]: https://lac.tf/

Here are the challenges I worked on, listed hardest first:

- [**web/quickstyle**](#webquickstyle): CSS injection with a bit of DOM clobbering. Unlike other CSS injection challenges, you must exfiltrate the flag with a single CSS file, and it has to be under 6 MB. This involved graph theory also used in bioinformatics.
- [**misc/jsfudge**](#miscjsfudge): [JSFuck][jsfuck] with some slight adjustments.
- [**rev/glottem**](#revglottem): Building a list of possible flags, character by character. Because this list grows exponentially, I manually intervened to keep only the partial flags that looked like English.
- [**web/new-housing-portal**](#webnew-housing-portal): XSS.
- [**crypto/selamat pagi**](#cryptoselamat-pagi): Frequency analysis, and the Indonesian Wikipedia.
- [**rev/aplet321**](#revaplet321): Decompiled the binary to find a system of equations to solve.
- [**rev/shattered-memories**](#revshattered-memories): [`strings`][strings].

[jsfuck]: https://jsfuck.com/
[strings]: https://en.wikipedia.org/wiki/Strings_(Unix)

## rev/shattered-memories

> **rev/shattered-memories**
> by aplet123.
> 697 solves / 115 points
>
> I swear I knew what the flag was but I can't seem to remember it anymore... can you dig it out from my inner psyche?
>
> **Downloads**:
> [shattered-memories](https://github.com/uclaacm/lactf-archive/blob/main/2024/rev/shattered-memories/shattered-memories)

This was the first challenge I looked at. I tried looking at the assembly, but then a teammate walked by, glanced at it, and suggested using `strings` on it.

```shell
$ strings ./shattered-memories
What was the flag again?
No, I definitely remember it being a different length...
t_what_f
t_means}
nd_forge
lactf{no
orgive_a
No, that definitely isn't it.
I'm pretty sure that isn't it.
I don't think that's it...
I think it's something like that but not quite...
There's something so slightly off but I can't quite put my finger on it...
Yes! That's it! That's the flag! I remember now!
;*3$"
```

Well, there are pieces of the flag:

- `t_what_f`
- `t_means}`
- `nd_forge`
- `lactf{no`
- `orgive_a`

And so the rest of the challenge was just putting the pieces together, which I did manually: `t_what_f` made the most sense after `no` to form "not"; the `f` completes the beginning of "forgive" in `orgive_a`; and "and" with `nd_forge`; leaving `t_means}`.

The flag is `lactf{not_what_forgive_and_forget_means}`.

## rev/aplet321

> **rev/aplet321**
> by kaiphait.
> 445 solves / 199 points
>
> Unlike Aplet123, Aplet321 might give you the flag if you beg him enough.
>
> `nc chall.lac.tf 31321`
>
> **Downloads**:
> [Dockerfile](https://github.com/uclaacm/lactf-archive/blob/main/2024/rev/aplet321/Dockerfile) [aplet321](https://github.com/uclaacm/lactf-archive/blob/main/2024/rev/aplet321/aplet321)

The [teammate from earlier](#revshattered-memories) had already solved it, and was reeling with laughter from the solution, but he didn't submit the flag.

He suggested I install [Ghidra][ghidra], but its installation seemed too involved (it's a large ZIP file, and it requires having Java installed and running a script I couldn't find after finally extracting everything). So I uploaded the file to [Dogbolt][dogbolt-aplet321] instead.

[ghidra]: https://ghidra-sre.org/
[dogbolt-aplet321]: https://dogbolt.org/?id=4c61df44-da40-4158-80b4-f4155fbf227e

```c
setbuf(stdout,(char *)0x0);
puts("hi, i\'m aplet321. how can i help?");
fgets(&local_238,0x200,stdin);
sVar2 = strlen(&local_238);
if (5 < sVar2) {
  iVar4 = 0;
  iVar5 = 0;
  pcVar3 = &local_238;
  do {
    iVar1 = strncmp(pcVar3,"pretty",6);
    iVar5 = iVar5 + (uint)(iVar1 == 0);
    iVar1 = strncmp(pcVar3,"please",6);
    iVar4 = iVar4 + (uint)(iVar1 == 0);
    pcVar3 = pcVar3 + 1;
  } while (pcVar3 != acStack_237 + ((int)sVar2 - 6));
  if (iVar4 != 0) {
    pcVar3 = strstr(&local_238,"flag");
    if (pcVar3 == (char *)0x0) {
      puts("sorry, i didn\'t understand what you mean");
      return 0;
    }
    if ((iVar5 + iVar4 == 0x36) && (iVar5 - iVar4 == -0x18)) {
      puts("ok here\'s your flag");
      system("cat flag.txt");
      return 0;
    }
    puts("sorry, i\'m not allowed to do that");
    return 0;
  }
}
puts("so rude");
return 0;
```

`local_238` has the user input, and `sVar2` is its length (which must be greater than 5 characters).

`pcVar3` seems to be like `i` in a for loop, incrementing in every iteration. It's a pointer to the current character in the loop and compares the next 6 characters from the pointer to `pretty` and `please`, incrementing `iVar5` and `iVar4` if so, respectively. The loop probably stops 6 characters before the end of the string (with the `sVar - 6`). This part counts the number of `pretty`s and `please`s in the input.

In JavaScript, the equivalent code might look something like this:

```js
let pretties = 0
let pleases = 0
for (let i = 0; i < input.length - 6; i++) {
  pretties += input.slice(i, i + 6) === 'pretty'
  pleases += input.slice(i, i + 6) === 'please'
}
```

Then, later, before printing the contents of `flag.txt`, it checks if `(iVar5 + iVar4 == 0x36) && (iVar5 - iVar4 == -0x18)`. This is a system of equations:

$$
\begin{cases}
  a + b = 54 \\
  a - b = -24
\end{cases}
$$

So that's $2a = 30 \to a = 15$ `pretty`s and $2b = 78 \to b = 39$ `please`s.

```js
> 'pretty'.repeat(15) + 'please'.repeat(39)
'prettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettypleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleaseplease'
```

```shell
$ nc chall.lac.tf 31321
hi, i'm aplet321. how can i help?
prettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettypleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleaseplease
sorry, i didn't understand what you mean
```

Why didn't that work? Well, there's also the `strstr(&local_238,"flag")` line that can't be `0x0`. [`strstr`][strstr] finds the second string, `flag`, in the first string, which is the input, and returns null if it can't find it. So we just need to add `flag` to our input:

```shell
$ nc chall.lac.tf 31321
hi, i'm aplet321. how can i help?
prettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettyprettypleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleasepleaseflag
ok here's your flag
lactf{next_year_i'll_make_aplet456_hqp3c1a7bip5bmnc}
```

That is a pretty amusing way to get a flag.

[strstr]: https://cplusplus.com/reference/cstring/strstr/

## crypto/selamat pagi

> **crypto/selamat pagi**
> by AVDestroyer.
> 331 solves / 275 points
>
> If you talk in another language, nobody can understand what you say! Check out this message I sent in Indonesian. To add some extra security, I also applied a monoalphabetic substitution cipher on it!
>
> **Downloads**:
> [message.txt](https://github.com/uclaacm/lactf-archive/blob/main/2024/crypto/selamat-pagi/message.txt)

```
Efe kqkbkx czwkf akfs kdkf qzfskf wzdcjtfk
Ieqku kqk akfs ikxj kck akfs wkak ukikukf :Q
Lzfqztk ukdj kqk qe wefe: bkvim{wzbkdki_ckse_kckukx_ukdj_wjuk_kfkbewew_mtzujzfwe}
```

I wasn't the one who started working on this one. I just heard Indonesian mentioned and was like, "languages?"

Our team used [dcode.fr's substitution cipher tool][dcode] to plug in letters visually.

`bkvim` is very likely to be `lactf`:

```
... a.ala. ...a. .a.. a.a. ....a. .......a
t..a. a.a .a.. ta.. a.a .a.. .a.a .ata.a. :.
......a .a.. a.a .. ....: lactf{..la.at_.a.._a.a.a._.a.._...a_a.al...._f........}
```

Our team had been plugging words into Google Translate to see what words could be. I thought that "flag" would very likely be in the text, so I used Wiktionary to look up the Indonesian translation for "flag": [_bendera_][bendera]. Their [Wikipedia article for the Indonesian flag][wiki] also uses _bendera_.

[bender]: https://en.wiktionary.org/wiki/bendera#Indonesian
[wiki]: https://id.wikipedia.org/wiki/Bendera_Indonesia
[dcode]: https://www.dcode.fr/monoalphabetic-substitution

The only 7-lever word that could fit _bendera_ was `......a`. Putting the letters in produces:

```
.n. adala. .e.an .an. a.an den.an .e...rna
t.da. ada .an. ta.. a.a .an. .a.a .ata.an :d
bendera .a.. ada d. ..n.: lactf{.ela.at_.a.._a.a.a._.a.._...a_anal...._fre..en..}
```

Maybe you can already see it, but my teammates, from plugging in other words, had already identified other letters like U and S:

```
.n. adala. .esan .an. a.an den.an se..urna
t.da. ada .an. ta.u a.a .an. sa.a .ata.an :d
bendera .a.u ada d. s.n.: lactf{sela.at_.a.._a.a.a._.a.u_su.a_anal.s.s_fre.uens.}
```

That `anal.s.s_fre.uens.` looks a lot like "frequency analysis." My teammates tried to plug in Q and Y, which I think is a bit English-minded because Q and Y are extremely unusual letters to use for the sounds /k/ and /i/. Particularly for a language that adopted the Latin alphabet, using K and I for those phonemes is much more common.

```
ini adala. .esan .an. a.an den.an se..urna tidak ada .an. ta.u a.a .an. sa.a katakan :d bendera ka.u ada di sini: lactf{sela.at_.a.i_a.aka._ka.u_suka_analisis_frekuensi}
```

I wasn't around when they finished the rest of the letters, but it was pretty quick. For example, Google autocomplete for _ini adala_ gives _ini adalah kerana_, so the letter after _adala_ must be H. Also, `sela.at` looks like it could be _selamat_ from the challenge name. And the word after, `.a.i`, could be _pagi_. And while this is already enough for the flag, there's still a missing letter remaining in `.ang`. Going down this [Indonesian letter frequency list][indofreq], it seems the most frequent letter we haven't used yet is Y. This produces:

```
Ini adalah pesan yang aman dengan sempurna
Tidak ada yang tahu apa yang saya katakan :D
Bendera kamu ada di sini: lactf{selamat_pagi_apakah_kamu_suka_analisis_frekuensi}
```

And through Google Translate:

> This is a perfectly secure message
>
> No one knows what I said :D
>
> Your flag is here: `lactf{good_morning_do_you_like_frequency_analysis}`

[indofreq]: https://www.sttmedia.com/characterfrequency-indonesian

## web/new-housing-portal

> **web/new-housing-portal**
> by r2uwu2.
> 214 solves / 368 points
>
> After that old portal, we decided to make a new one that is ultra secure and not based off any real housing sites. Can you make Samy tell you his deepest darkest secret?
>
> Hint - You can send a link that the admin bot will visit as samy.
>
> Hint - Come watch the real Samy's talk if you are stuck!
>
> Site - [new-housing-portal.chall.lac.tf](https://new-housing-portal.chall.lac.tf/)
>
> Admin Bot - <https://admin-bot.lac.tf/new-housing-portal>
>
> **Downloads**:
> [new-housing-portal.zip](https://github.com/uclaacm/lactf-archive/tree/main/2024/web/new-housing-portal)

## misc/jsfudge

> **misc/jsfudge**
> by r2dev2.
> 31 solves / 486 points
>
> JsFudge this JsFudge that, why don't you JsFudge the flag.
>
> `nc chall.lac.tf 31130`
>
> **Downloads**:
> [Dockerfile](https://github.com/uclaacm/lactf-archive/blob/main/2024/misc/jsfudge/Dockerfile) [index.js](https://github.com/uclaacm/lactf-archive/blob/main/2024/misc/jsfudge/index.js)

## rev/glottem

> **rev/glottem**
> by aplet123.
> 89 solves / 455 points
>
> Haha glottem good!
>
> Note: The correct flag is 34 characters long.
>
> **Downloads**:
> [glottem](https://github.com/uclaacm/lactf-archive/blob/main/2024/rev/glottem/glottem)

## web/quickstyle

> **web/quickstyle**
> by r2uwu2.
> 12 solves / 495 points
>
> Script on the streets, style in the sheets, they call me the cascader.
>
> Site - [quickstyle.chall.lac.tf](https://quickstyle.chall.lac.tf/)
>
> Admin Bot - <https://admin-bot.lac.tf/quickstyle>
>
> **Downloads**:
> [quickstyle.zip](https://github.com/uclaacm/lactf-archive/tree/main/2024/web/quickstyle)
